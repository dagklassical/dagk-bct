---
// src/pages/blockchain/music-cards/index.astro
import Layout from '../../../layouts/Layout.astro';
import musicCards from '../../../data/music-cards.json';
import releases from '../../../data/releases.json';
import artists from '../../../data/artists.json';

// Mapas para lookup rápido
const releaseMap = releases.reduce((acc, r) => ({ ...acc, [r.id]: r }), {});
const artistMap = artists.reduce((acc, a) => ({ ...acc, [a.id]: a }), {});

const availableCards = musicCards.filter(card => card.status === 'available');

const breadcrumbs = [
  { label: 'Inicio', href: '/' },
  { label: 'Blockchain', href: '/blockchain/' },
  { label: 'Music Cards', href: '/blockchain/music-cards/' },
];
---

<Layout title="Music Cards en Oferta" description="Colecciona activos musicales verificables en blockchain" breadcrumbs={breadcrumbs}>

  <header class="text-center mb-8 py-6 bg-white">
    <h1 class="text-h1 font-advent">Music Cards en Oferta</h1>
    <p class="text-dag-burgundy mt-2">
      Ediciones limitadas, certificadas en blockchain, con beneficios únicos.
    </p>
  </header>

  <div class="max-w-6xl mx-auto px-4">
    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6">
      {availableCards.map(card => {
        const release = releaseMap[card.associatedRelease];
        const artist = release?.artistIds?.[0] ? artistMap[release.artistIds[0]] : null;
        return (
          <a 
            href={`/blockchain/music-cards/${card.id}`} 
            class="block group border border-slate-200 rounded-md p-2 hover:border-dag-burgundy/40 transition-colors bg-white shadow-sm"
            key={card.id}
          >
            <!-- Imagen de la Music Card -->
            <div class="aspect-[3/4] bg-slate-100 rounded-md overflow-hidden mb-4">
              {card.cardImage ? (
                <img src={card.cardImage} alt={card.title} class="w-full h-full object-cover" />
              ) : (
                <div class="w-full h-full flex items-center justify-center text-slate-400 text-xs">
                  Sin imagen
                </div>
              )}
            </div>

            <!-- Título y artista -->
            <h3 class="text-h3 font-advent text-slate-800 group-hover:text-dag-burgundy">{card.title}</h3>
            {artist && <p class="text-sm text-slate-600 mt-1">por {artist.name}</p>}

            <!-- Edición y disponibilidad -->
            <div class="mt-3 flex justify-between items-center text-sm">
              <span class="px-2 py-1 bg-dag-burgundy/10 text-dag-burgundy rounded">
                {card.edition}
              </span>
              <span class="text-slate-500">
                {card.available} de {card.totalSupply}
              </span>
            </div>

            <!-- Precio -->
            <div class="mt-3 pt-3 border-t border-slate-100">
              <p class="font-semibold text-lg">{card.price}</p>
              <p class="text-xs text-slate-500">en {card.blockchain}</p>
            </div>
          </a>
        );
      })}
    </div>

    {availableCards.length === 0 && (
      <p class="text-center text-slate-500 py-10">No hay Music Cards disponibles en este momento.</p>
    )}
  </div>
</Layout>